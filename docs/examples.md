# Examples

This document provides comprehensive examples of using flags-gen in various scenarios, from simple configurations to complex real-world applications.

## Table of Contents

- [Basic Examples](#basic-examples)
- [Type Examples](#type-examples)  
- [Advanced Configuration](#advanced-configuration)
- [Integration Patterns](#integration-patterns)
- [Real-World Examples](#real-world-examples)
- [Best Practices](#best-practices)

## Basic Examples

### Simple Configuration

The most basic usage of flags-gen with a simple configuration struct:

**Input** (`config.go`):
```go
package config

// +flags-gen
// AppConfig holds basic application configuration
type AppConfig struct {
    // Name is the application name
    Name string `json:"name" default:"myapp"`
    
    // Port is the port to listen on
    Port int `json:"port" default:"8080"`
    
    // Debug enables debug mode
    Debug bool `json:"debug"`
}
```

**Generate flags**:
```bash
flags-gen -i config.go -o config_flags.go
```

**Generated output** (`config_flags.go`):
```go
// Code generated by flags-gen. DO NOT EDIT.

package config

import "github.com/spf13/pflag"

// AddFlags adds all the flags from AppConfig to the given FlagSet
func (o *AppConfig) AddFlags(flags *pflag.FlagSet) {
    flags.StringVar(&o.Name, "name", "myapp", "Name is the application name")
    flags.IntVar(&o.Port, "port", 8080, "Port is the port to listen on")
    flags.BoolVar(&o.Debug, "debug", false, "Debug enables debug mode")
}
```

**Usage in CLI**:
```go
package main

import (
    "fmt"
    "github.com/spf13/cobra"
    "your-project/config"
)

func main() {
    cfg := &config.AppConfig{}
    
    rootCmd := &cobra.Command{
        Use: "myapp",
        Run: func(cmd *cobra.Command, args []string) {
            fmt.Printf("App: %s, Port: %d, Debug: %t\n", cfg.Name, cfg.Port, cfg.Debug)
        },
    }
    
    cfg.AddFlags(rootCmd.Flags())
    rootCmd.Execute()
}
```

**CLI Usage**:
```bash
./myapp --name "MyApplication" --port 9000 --debug
# Output: App: MyApplication, Port: 9000, Debug: true
```

## Type Examples

### All Supported Types

Here's an example demonstrating all supported types:

**Input** (`types.go`):
```go
package examples

import "time"

// +flags-gen
// AllTypesConfig demonstrates all supported flag types
type AllTypesConfig struct {
    // String configuration
    Message string `json:"message" default:"Hello, World!"`
    
    // Integer types
    Count        int   `json:"count" default:"10"`
    SmallNumber  int32 `json:"smallNumber" default:"100"`
    LargeNumber  int64 `json:"largeNumber" default:"1000000"`
    
    // Unsigned integer types
    Size       uint   `json:"size" default:"1024"`
    SmallSize  uint32 `json:"smallSize" default:"512"`
    LargeSize  uint64 `json:"largeSize" default:"2048"`
    
    // Boolean flag
    Enabled bool `json:"enabled"`
    
    // Float types
    Rate      float32 `json:"rate" default:"0.5"`
    Precision float64 `json:"precision" default:"0.123456789"`
    
    // Slice types
    Tags    []string `json:"tags" default:"production,api,v1"`
    Ports   []int    `json:"ports" default:"80,443,8080"`
    
    // Duration type
    Timeout time.Duration `json:"timeout" default:"30s"`
}
```

**Generated flags usage**:
```bash
./app --message "Custom message" \
      --count 20 \
      --small-number 200 \
      --large-number 2000000 \
      --size 2048 \
      --enabled \
      --rate 0.75 \
      --precision 0.987654321 \
      --tags "staging,api,v2" \
      --ports "8080,9000,9001" \
      --timeout 45s
```

### Custom Flag Names

Control flag names using JSON tags:

**Input** (`custom_names.go`):
```go
package config

// +flags-gen
// DatabaseConfig shows custom flag naming
type DatabaseConfig struct {
    // Use custom flag name
    DatabaseURL string `json:"database-url" default:"sqlite://app.db"`
    
    // Abbreviate long field names
    MaxConnections int `json:"max-conn" default:"10"`
    
    // Keep original name with json tag
    Username string `json:"username" default:"admin"`
    
    // Override camelCase conversion
    APITimeout time.Duration `json:"api-timeout" default:"30s"`
}
```

**Generated flags**:
- `--database-url` (from JSON tag)
- `--max-conn` (abbreviated)
- `--username` (explicit JSON tag)
- `--api-timeout` (explicit JSON tag)

## Advanced Configuration

### Complex Default Values

**Input** (`complex_defaults.go`):
```go
package config

import "time"

// +flags-gen
// ServerConfig demonstrates complex default values
type ServerConfig struct {
    // Multiple allowed origins for CORS
    AllowedOrigins []string `json:"allowedOrigins" default:"http://localhost:3000,http://localhost:8080,https://myapp.com"`
    
    // Multiple listen ports
    ListenPorts []int `json:"listenPorts" default:"8080,8443"`
    
    // Complex duration with units
    SessionTimeout time.Duration `json:"sessionTimeout" default:"24h"`
    ReadTimeout    time.Duration `json:"readTimeout" default:"30s"`
    WriteTimeout   time.Duration `json:"writeTimeout" default:"30s"`
    
    // String with special characters
    JWTSecret string `json:"jwtSecret" default:"your-256-bit-secret"`
    
    // Boolean with default true (unusual but possible)
    EnableHTTPS bool `json:"enableHTTPS" default:"true"`
}
```

### Configuration Sections

Organize configuration into logical sections:

**Input** (`sections.go`):
```go
package config

import "time"

// +flags-gen
// HTTPConfig contains HTTP server settings
type HTTPConfig struct {
    Host         string        `json:"host" default:"localhost"`
    Port         int           `json:"port" default:"8080"`
    ReadTimeout  time.Duration `json:"readTimeout" default:"30s"`
    WriteTimeout time.Duration `json:"writeTimeout" default:"30s"`
}

// +flags-gen
// DatabaseConfig contains database settings
type DatabaseConfig struct {
    Driver   string `json:"driver" default:"sqlite"`
    URL      string `json:"url" default:"sqlite://app.db"`
    MaxConns int    `json:"maxConns" default:"10"`
}

// +flags-gen
// LoggingConfig contains logging settings
type LoggingConfig struct {
    Level  string `json:"level" default:"info"`
    Format string `json:"format" default:"json"`
    Output string `json:"output" default:"stdout"`
}
```

Each struct gets its own `AddFlags` method, allowing for modular flag organization.

## Integration Patterns

### With Cobra Subcommands

**Application structure**:
```go
package main

import (
    "github.com/spf13/cobra"
    "your-project/config"
)

func main() {
    serverCfg := &config.HTTPConfig{}
    dbCfg := &config.DatabaseConfig{}
    
    rootCmd := &cobra.Command{Use: "myapp"}
    
    // Server command with HTTP config
    serverCmd := &cobra.Command{
        Use: "server",
        Run: func(cmd *cobra.Command, args []string) {
            runServer(serverCfg, dbCfg)
        },
    }
    serverCfg.AddFlags(serverCmd.Flags())
    dbCfg.AddFlags(serverCmd.Flags()) // Shared database config
    
    // Migration command with database config only
    migrateCmd := &cobra.Command{
        Use: "migrate",
        Run: func(cmd *cobra.Command, args []string) {
            runMigration(dbCfg)
        },
    }
    dbCfg.AddFlags(migrateCmd.Flags())
    
    rootCmd.AddCommand(serverCmd, migrateCmd)
    rootCmd.Execute()
}
```

### With Environment Variables (Viper)

**Complete integration example**:
```go
package main

import (
    "fmt"
    "strings"
    
    "github.com/spf13/cobra"
    "github.com/spf13/viper"
    "your-project/config"
)

func main() {
    cfg := &config.ServerConfig{}
    
    rootCmd := &cobra.Command{
        Use: "myapp",
        PreRunE: func(cmd *cobra.Command, args []string) error {
            // Setup viper for environment variables
            viper.SetEnvPrefix("MYAPP")
            viper.SetEnvKeyReplacer(strings.NewReplacer("-", "_"))
            viper.AutomaticEnv()
            
            // Bind command line flags
            if err := viper.BindPFlags(cmd.Flags()); err != nil {
                return err
            }
            
            // Unmarshal into config struct
            return viper.Unmarshal(cfg)
        },
        Run: func(cmd *cobra.Command, args []string) {
            fmt.Printf("Config: %+v\n", cfg)
        },
    }
    
    cfg.AddFlags(rootCmd.Flags())
    rootCmd.Execute()
}
```

**Usage with environment variables**:
```bash
# Using flags
./myapp --host 0.0.0.0 --port 9000

# Using environment variables
export MYAPP_HOST=0.0.0.0
export MYAPP_PORT=9000
./myapp

# Environment variables override defaults, flags override environment
export MYAPP_HOST=0.0.0.0
./myapp --port 9000  # Host from env, port from flag
```

### With Configuration Files

**Using Viper with config files**:
```go
func initConfig() {
    cfg := &config.AppConfig{}
    
    // Setup viper
    viper.SetConfigName("config")
    viper.SetConfigType("yaml")
    viper.AddConfigPath(".")
    viper.AddConfigPath("/etc/myapp/")
    
    // Set environment variable support
    viper.SetEnvPrefix("MYAPP")
    viper.AutomaticEnv()
    
    // Read config file
    if err := viper.ReadInConfig(); err != nil {
        if _, ok := err.(viper.ConfigFileNotFoundError); !ok {
            log.Fatal(err)
        }
    }
    
    // Command setup...
    rootCmd := &cobra.Command{
        Use: "myapp",
        PreRun: func(cmd *cobra.Command, args []string) {
            viper.BindPFlags(cmd.Flags())
            viper.Unmarshal(cfg)
        },
    }
    
    cfg.AddFlags(rootCmd.Flags())
}
```

**Priority order** (highest to lowest):
1. Command line flags
2. Environment variables
3. Configuration file
4. Default values from struct tags

## Real-World Examples

### Web Server Configuration

**Complete web server configuration**:
```go
package config

import "time"

// +flags-gen
// ServerConfig contains all web server configuration
type ServerConfig struct {
    // Server settings
    Host string `json:"host" default:"localhost"`
    Port int    `json:"port" default:"8080"`
    
    // TLS settings
    EnableTLS bool   `json:"enableTLS"`
    CertFile  string `json:"certFile" default:"server.crt"`
    KeyFile   string `json:"keyFile" default:"server.key"`
    
    // Timeouts
    ReadTimeout       time.Duration `json:"readTimeout" default:"30s"`
    WriteTimeout      time.Duration `json:"writeTimeout" default:"30s"`
    IdleTimeout       time.Duration `json:"idleTimeout" default:"120s"`
    ReadHeaderTimeout time.Duration `json:"readHeaderTimeout" default:"10s"`
    
    // CORS settings
    AllowedOrigins []string `json:"allowedOrigins" default:"*"`
    AllowedMethods []string `json:"allowedMethods" default:"GET,POST,PUT,DELETE,OPTIONS"`
    AllowedHeaders []string `json:"allowedHeaders" default:"Origin,Content-Type,Accept,Authorization"`
    
    // Rate limiting
    EnableRateLimit bool `json:"enableRateLimit"`
    RequestsPerSec  int  `json:"requestsPerSec" default:"100"`
    
    // Monitoring
    EnableMetrics bool   `json:"enableMetrics" default:"true"`
    MetricsPath   string `json:"metricsPath" default:"/metrics"`
    HealthPath    string `json:"healthPath" default:"/health"`
    
    // Logging
    LogLevel  string `json:"logLevel" default:"info"`
    LogFormat string `json:"logFormat" default:"json"`
}
```

### Database Configuration

**Database connection and pool configuration**:
```go
package config

import "time"

// +flags-gen
// DatabaseConfig contains database configuration
type DatabaseConfig struct {
    // Connection settings
    Driver   string `json:"driver" default:"postgres"`
    Host     string `json:"dbHost" default:"localhost"`
    Port     int    `json:"dbPort" default:"5432"`
    Database string `json:"database" default:"myapp"`
    Username string `json:"username" default:"postgres"`
    Password string `json:"password"`
    SSLMode  string `json:"sslMode" default:"disable"`
    
    // Connection pool settings
    MaxOpenConns    int           `json:"maxOpenConns" default:"25"`
    MaxIdleConns    int           `json:"maxIdleConns" default:"5"`
    ConnMaxLifetime time.Duration `json:"connMaxLifetime" default:"1h"`
    ConnMaxIdleTime time.Duration `json:"connMaxIdleTime" default:"15m"`
    
    // Query settings
    QueryTimeout time.Duration `json:"queryTimeout" default:"30s"`
    
    // Migration settings
    MigrationsDir    string `json:"migrationsDir" default:"./migrations"`
    AutoMigrate      bool   `json:"autoMigrate"`
    MigrationTimeout time.Duration `json:"migrationTimeout" default:"300s"`
}
```

### Kubernetes Operator Configuration

**Based on the example in the codebase**:
```go
package config

import (
    "time"
    metav1 "k8s.io/apimachinery/pkg/apis/meta/v1"
)

// +flags-gen
// OperatorConfig defines configuration options for a Kubernetes operator
type OperatorConfig struct {
    metav1.TypeMeta `json:",inline"` // Embedded struct (skipped)

    // Controllers is a list of controllers to enable. '*' enables all on-by-default controllers,
    // 'foo' enables the controller named 'foo', '-foo' disables the controller named 'foo'.
    Controllers []string `json:"controllers" default:"*"`

    // ProbeAddr is the address the probe endpoint binds to.
    ProbeAddr string `json:"probeAddr" default:":8080"`

    // MetricsAddr is the address the metrics endpoint binds to.
    MetricsAddr string `json:"metricsAddr" default:":8443"`

    // ProbeHealthEndpoint is the endpoint for the health probe.
    ProbeHealthEndpoint string `json:"probeHealthEndpoint" default:"healthz"`

    // ProbeReadyEndpoint is the endpoint for the ready probe.
    ProbeReadyEndpoint string `json:"probeReadyEndpoint" default:"readyz"`

    // EnableLeaderElection enables leader election for controller manager.
    // Enabling this will ensure there is only one active controller manager.
    EnableLeaderElection bool `json:"enableLeaderElection"`

    // ZapDevMode enables development mode for zap logger.
    // Enabling this will use human-readable output instead of structured JSON.
    ZapDevMode bool `json:"zapDevMode"`

    // V is the log level for V logs.
    V int `json:"v"`

    // RequiredCRDs is a list of CRDs that must be present before starting the controller manager.
    // Format: group/version/kind. Example: eventing.knative.dev/v1/Broker
    RequiredCRDs []string `json:"requiredCRDs" default:"eventing.knative.dev/v1/Broker,eventing.knative.dev/v1/Trigger"`

    // RequiredCRDsGracePeriod is the grace period for the required CRDs to be present
    // before starting the controller manager.
    RequiredCRDsGracePeriod time.Duration `json:"requiredCRDsGracePeriod" default:"30s"`

    // RuntimeConfigMapName is the name of the runtime config map.
    RuntimeConfigMapName string `json:"runtimeConfigMapName" default:"runtime-configmap"`

    // RuntimeConfigMapNamespace is the namespace of the runtime config map.
    RuntimeConfigMapNamespace string `json:"runtimeConfigMapNamespace"`

    // RuntimeConfigKey is the key of the runtime config in the configmap.
    RuntimeConfigKey string `json:"runtimeConfigKey" default:"runtime-config.yaml"`
}
```

**Usage in operator**:
```go
package main

import (
    "context"
    "flag"
    "os"
    
    "github.com/spf13/cobra"
    "sigs.k8s.io/controller-runtime"
    "your-operator/config"
)

func main() {
    cfg := &config.OperatorConfig{}
    
    rootCmd := &cobra.Command{
        Use: "operator",
        RunE: func(cmd *cobra.Command, args []string) error {
            return runOperator(cfg)
        },
    }
    
    cfg.AddFlags(rootCmd.Flags())
    
    if err := rootCmd.Execute(); err != nil {
        os.Exit(1)
    }
}

func runOperator(cfg *config.OperatorConfig) error {
    mgr, err := ctrl.NewManager(ctrl.GetConfigOrDie(), ctrl.Options{
        Scheme:                 scheme,
        MetricsBindAddress:     cfg.MetricsAddr,
        Port:                   9443,
        HealthProbeBindAddress: cfg.ProbeAddr,
        LeaderElection:         cfg.EnableLeaderElection,
        LeaderElectionID:       "operator-lock",
    })
    if err != nil {
        return err
    }
    
    // Setup controllers based on cfg.Controllers
    // Setup health and ready checks
    // Start manager
    
    return mgr.Start(context.Background())
}
```

## Best Practices

### 1. Descriptive Comments

Always provide clear, helpful comments for your fields:

```go
// +flags-gen
type Config struct {
    // LogLevel sets the minimum log level to output.
    // Valid levels: debug, info, warn, error
    LogLevel string `json:"logLevel" default:"info"`
    
    // MaxRetries is the maximum number of retry attempts for failed operations.
    // Set to 0 to disable retries, -1 for unlimited retries.
    MaxRetries int `json:"maxRetries" default:"3"`
    
    // DatabaseURL is the connection string for the database.
    // Format: driver://user:password@host:port/database
    // Example: postgres://user:pass@localhost:5432/mydb
    DatabaseURL string `json:"databaseURL" default:"sqlite://app.db"`
}
```

### 2. Sensible Defaults

Choose defaults that work for most users:

```go
type ServerConfig struct {
    // Use common default port
    Port int `json:"port" default:"8080"`
    
    // Conservative timeout defaults
    ReadTimeout  time.Duration `json:"readTimeout" default:"30s"`
    WriteTimeout time.Duration `json:"writeTimeout" default:"30s"`
    
    // Safe development defaults
    Host string `json:"host" default:"localhost"` // Don't default to 0.0.0.0
    
    // Enable useful features by default
    EnableMetrics bool `json:"enableMetrics" default:"true"`
}
```

### 3. Logical Grouping

Group related configuration in separate structs:

```go
// +flags-gen
type HTTPConfig struct {
    Host         string        `json:"host" default:"localhost"`
    Port         int           `json:"port" default:"8080"`
    ReadTimeout  time.Duration `json:"readTimeout" default:"30s"`
    WriteTimeout time.Duration `json:"writeTimeout" default:"30s"`
}

// +flags-gen  
type DatabaseConfig struct {
    URL      string `json:"url" default:"sqlite://app.db"`
    MaxConns int    `json:"maxConns" default:"10"`
}

// +flags-gen
type LoggingConfig struct {
    Level  string `json:"level" default:"info"`
    Format string `json:"format" default:"json"`
}
```

### 4. Consistent Naming

Use consistent naming patterns for flags:

```go
type Config struct {
    // Database-related flags all start with "db"
    DatabaseURL      string `json:"db-url"`
    DatabaseTimeout  time.Duration `json:"db-timeout"`
    DatabaseMaxConns int `json:"db-max-conns"`
    
    // HTTP-related flags all start with "http"
    HTTPHost string `json:"http-host"`
    HTTPPort int    `json:"http-port"`
    
    // Use clear, unambiguous names
    EnableTLS    bool `json:"enable-tls"`    // Clear
    TLSEnabled   bool `json:"tls-enabled"`   // Also clear
    TLS          bool `json:"tls"`           // Less clear
}
```

### 5. Validation

Consider adding validation methods to your config structs:

```go
// +flags-gen
type ServerConfig struct {
    Host string `json:"host" default:"localhost"`
    Port int    `json:"port" default:"8080"`
}

// Validate checks the configuration for common errors
func (c *ServerConfig) Validate() error {
    if c.Port < 1 || c.Port > 65535 {
        return fmt.Errorf("port must be between 1 and 65535, got %d", c.Port)
    }
    
    if c.Host == "" {
        return fmt.Errorf("host cannot be empty")
    }
    
    return nil
}
```

### 6. Documentation Examples

Include usage examples in your comments:

```go
// +flags-gen
type APIConfig struct {
    // APIKey is the secret key for API authentication.
    // Example: --api-key "sk-1234567890abcdef"
    APIKey string `json:"apiKey"`
    
    // AllowedOrigins contains CORS allowed origins.
    // Multiple origins can be specified with comma separation.
    // Examples: 
    //   --allowed-origins "https://example.com"
    //   --allowed-origins "https://app.com,https://api.com"
    AllowedOrigins []string `json:"allowedOrigins" default:"*"`
}
```

### 7. Security Considerations

Be careful with sensitive defaults and help text:

```go
type SecurityConfig struct {
    // Don't put secrets in default values
    JWTSecret string `json:"jwtSecret"` // No default for security
    
    // Be vague about sensitive options in help text
    DatabasePassword string `json:"dbPassword"` // Comment: "Database password"
    
    // Consider marking sensitive flags
    APIKey string `json:"apiKey"` // Could be marked as sensitive in the future
}
```

These examples should provide a comprehensive guide for using flags-gen in various scenarios. The key is to start simple and gradually adopt more advanced patterns as your application grows in complexity.